<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Elite Archive | Interactive Success Journal</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Patrick+Hand&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --navy: #040810; --paper: #fcfaf5; --ink: #111;
            --gold: #d4af37; --gold-foil: #f1c40f; --wax: #7b0000;
            --leaf: #10b981; --border: rgba(255,255,255,0.1);
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Patrick Hand', cursive; 
            background: #050505;
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;
            min-height: 100vh; overflow: hidden; perspective: 1500px;
            touch-action: none;
        }

        .spiral {
            position: absolute; top: 12px; left: 50%; transform: translateX(-50%);
            width: 82%; height: 35px; display: flex; justify-content: space-around; z-index: 2000;
        }
        .wire {
            width: 10px; height: 35px; background: linear-gradient(90deg, #222, #ddd, #222);
            border-radius: 5px; box-shadow: 0 4px 10px rgba(0,0,0,0.7);
        }

        .scene { width: 94%; max-width: 420px; height: 82vh; transform-style: preserve-3d; margin-bottom: 50px; will-change: transform; }
        .book { 
            position: relative; width: 100%; height: 100%; background: var(--navy); 
            border-radius: 18px; transform-style: preserve-3d; 
            box-shadow: 0 50px 120px rgba(0,0,0,1); transition: transform 0.1s ease-out;
        }

        .cover { 
            position: absolute; inset: 0; background: radial-gradient(circle at 50% 50%, #0a1b33 0%, #040810 100%);
            border-radius: 18px; z-index: 500; transform-origin: top; 
            transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            backface-visibility: hidden; cursor: pointer; border: 1px solid var(--border); overflow: hidden;
        }

        .main-plate {
            z-index: 10; padding: 35px; border: 1px solid var(--gold);
            background: rgba(0,0,0,0.6); text-align: center; backdrop-filter: blur(12px);
            transform: translateZ(80px); box-shadow: 0 30px 60px rgba(0,0,0,0.8);
        }
        .main-plate h1 { margin: 0; font-family: 'Montserrat', sans-serif; font-size: 2.4rem; color: #fff; letter-spacing: 10px; text-shadow: 0 0 15px var(--gold); }
        .main-plate p { color: var(--gold); margin-top: 12px; font-size: 0.65rem; letter-spacing: 5px; font-weight: bold; }

        .book.open .cover { transform: rotateX(165deg); }

        .page-container { position: absolute; inset: 8px; transform-style: preserve-3d; }
        .page { 
            position: absolute; inset: 0; background: var(--paper); 
            padding: 22px; border-radius: 6px; transform-origin: top; 
            backface-visibility: hidden; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); z-index: 10; overflow-y: auto;
            border-top: 12px solid #ddd;
        }
        .page.flipping { transform: rotateX(180deg) scaleY(1.05); filter: brightness(0.8); }
        .page.locked { filter: sepia(0.3) contrast(0.9); pointer-events: none; }

        .growth-meter { height: 12px; background: #e5e7eb; border-radius: 20px; overflow: hidden; margin: 12px 0; border: 1px solid #d1d5db; }
        #growthFill { width: 0%; height: 100%; background: linear-gradient(90deg, var(--leaf), var(--gold-foil)); transition: 1.5s; }

        .habit-dock { display: flex; justify-content: space-around; padding: 15px; background: #fff; border-radius: 15px; margin-bottom: 20px; border: 1px solid #eee; }
        .badge { font-size: 1.8rem; opacity: 0.2; transition: 0.3s; cursor: pointer; filter: grayscale(1); }
        .badge.active { opacity: 1; transform: scale(1.3) rotate(5deg); filter: grayscale(0); }

        .time-row { display: flex; align-items: center; gap: 12px; padding: 10px 0; border-bottom: 1px solid #f3f4f6; }
        .time-check { width: 24px; height: 24px; accent-color: var(--leaf); cursor: pointer; }

        .drawer-toggle { background: var(--navy); color: #fff; padding: 14px; text-align: center; cursor: pointer; font-weight: bold; border-radius: 12px; margin-top: 20px; font-size: 0.9rem; letter-spacing: 2px; }
        #pocket { max-height: 0; overflow: hidden; transition: 0.6s ease-in-out; }
        #pocket.open { max-height: 1000px; padding-top: 20px; }
        
        .tilted-polaroid { 
            width: 85%; background: #fff; padding: 12px 12px 60px 12px; 
            box-shadow: 5px 15px 35px rgba(0,0,0,0.3); margin: 20px auto; 
            border: 1px solid #eee; cursor: pointer; transition: 0.4s;
            transform: rotate(-3deg); position: relative;
        }
        .tilted-polaroid img { width: 100%; height: auto; display: block; border: 1px solid #f0f0f0; min-height: 150px; object-fit: cover;}
        .tilted-polaroid::before { content: ''; position: absolute; top: -15px; left: 35%; width: 60px; height: 25px; background: rgba(212, 175, 55, 0.2); transform: rotate(5deg); }

        .nav-dock { position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; background: rgba(0,0,0,0.9); backdrop-filter: blur(20px); padding: 12px 20px; border-radius: 60px; z-index: 5000; border: 1px solid var(--border); }
        .nav-btn { width: 48px; height: 48px; border-radius: 50%; background: #fff; border: none; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px rgba(0,0,0,0.5); cursor: pointer; transition: 0.2s; color: var(--navy); font-size: 1.1rem; }
        .nav-btn.main { width: 64px; height: 64px; background: var(--gold); color: white; transform: translateY(-22px); border: 4px solid var(--navy); }

        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 6000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { background: #fff; padding: 30px; border-radius: 25px; width: 100%; max-width: 360px; text-align: center; }

        #waxSeal { position: absolute; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--wax); border-radius: 50%; color: var(--gold); display: flex; align-items: center; justify-content: center; transform: scale(0); transition: 0.5s; cursor: pointer; z-index: 100; font-size: 1.5rem; box-shadow: 0 10px 20px rgba(0,0,0,0.5); }
        #waxSeal.sealed { transform: scale(1); }
    </style>
</head>
<body onload="init()">

    <div class="spiral">
        <div class="wire"></div><div class="wire"></div><div class="wire"></div><div class="wire"></div>
        <div class="wire"></div><div class="wire"></div><div class="wire"></div><div class="wire"></div>
    </div>

    <audio id="flipSound"><source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg"></audio>
    <input type="file" id="imgInp" hidden accept="image/*" onchange="processImg(event)">

    <div class="overlay" id="calOverlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h3 style="font-family: Playfair Display;">Select Target Date</h3>
            <button onclick="jumpToday()" style="width:100%; padding:14px; background:var(--gold); border:none; color:white; border-radius:10px; font-weight:bold; margin-bottom:20px;">BACK TO TODAY</button>
            <div id="calGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap: 6px;"></div>
        </div>
    </div>

    <div class="overlay" id="reportOverlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="font-family: Playfair Display; color: var(--navy);">Success Report</h2>
            <div style="font-size: 4.5rem; font-weight: 900; color: var(--leaf);" id="reportPerc">0%</div>
            <div class="growth-meter"><div id="reportFill" style="height:100%; background:var(--leaf); width:0%;"></div></div>
            <p id="quote" style="font-style: italic; color: #666; margin-top: 15px;"></p>
            <button onclick="document.getElementById('reportOverlay').style.display='none'" style="width:100%; padding:14px; margin-top:15px; background:var(--navy); color:white; border-radius:12px; border:none; font-weight:bold;">DONE</button>
        </div>
    </div>

    <div class="scene">
        <div class="book" id="book" onmousemove="handleMove(event)" onmouseleave="resetMove()">
            <div class="cover" onclick="openBook()">
                <div class="main-plate">
                    <h1>ARCHIVE</h1>
                    <p>PRECISION ‚Ä¢ STRATEGY ‚Ä¢ POWER</p>
                </div>
            </div>

            <div class="page-container" id="swipeArea">
                <div class="page" id="page">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="dateDisp" style="color:var(--navy); font-weight:bold; font-family: Playfair Display; font-size:1.2rem;"></span>
                        <span id="percDisp" style="color:var(--leaf); font-weight:bold;">0%</span>
                    </div>
                    <div class="growth-meter"><div id="growthFill"></div></div>

                    <div class="habit-dock">
                        <span class="badge" onclick="tapHabit('water')" id="h_water">üíß</span>
                        <span class="badge" onclick="tapHabit('gym')" id="h_gym">üí™</span>
                        <span class="badge" onclick="tapHabit('read')" id="h_read">üìö</span>
                        <span class="badge" onclick="tapHabit('sun')" id="h_sun">‚òÄÔ∏è</span>
                        <span class="badge" onclick="tapHabit('zen')" id="h_zen">üßò</span>
                    </div>

                    <div id="schedule"></div>

                    <textarea id="notes" class="save" style="margin-top:20px; height:110px; border-left:4px solid var(--gold); padding:15px; width:100%; border:none; background:#f9fafb; font-size: 1.1rem;" placeholder="Describe your success today..."></textarea>

                    <div class="drawer-toggle" onclick="toggleDrawer()">üóùÔ∏è THE SECRET DRAWER</div>
                    <div id="pocket">
                        <div class="tilted-polaroid" onclick="document.getElementById('imgInp').click()">
                            <img id="userImg" src="">
                            <p style="position:absolute; bottom:15px; left:0; width:100%; text-align:center; font-size:0.8rem; color:#888;">CAPSULED MEMORY</p>
                        </div>
                        <textarea id="secret" class="save" style="height:80px; width:100%; border:1px solid #f1f5f9; padding:12px; border-radius:8px;" placeholder="Private notes..."></textarea>
                    </div>

                    <div id="waxSeal" onclick="toggleSeal()">‚ùÄ</div>
                </div>
            </div>
        </div>
    </div>

    <nav class="nav-dock">
        <button class="nav-btn" onclick="openCal()"><i class="fas fa-calendar-alt"></i></button>
        <button class="nav-btn main" onclick="closeBook()"><i class="fas fa-home"></i></button>
        <button class="nav-btn" onclick="syncLast()" style="color:var(--gold);"><i class="fas fa-sync"></i></button>
        <button class="nav-btn" onclick="clearDay()" style="color:var(--wax);"><i class="fas fa-eraser"></i></button>
        <button class="nav-btn" onclick="openReport()"><i class="fas fa-chart-line"></i></button>
    </nav>

<script>
    let vDate = new Date(); vDate.setHours(0,0,0,0);
    let habits = {}, sealed = false, flipping = false;
    
    // SVG local data URI replaces external via.placeholder link
    const LOCAL_PLACEHOLDER = "data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='350' height='300'%3E%3Crect width='350' height='300' fill='%23f1f1f1'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='sans-serif' font-size='18' fill='%23aaa'%3ETap to Upload Memory%3C/text%3E%3C/svg%3E";

    let touchStartY = 0;
    let touchEndY = 0;

    function init() {
        const s = document.getElementById('schedule');
        s.innerHTML = '';
        for(let h=6; h<=23; h++) {
            let lbl = h > 12 ? (h-12)+' PM' : (h==12 ? '12 PM' : h+' AM');
            s.innerHTML += `<div class="time-row"><span style="font-size:0.75rem; color:#94a3b8; width:45px; font-weight:bold;">${lbl}</span><input type="checkbox" id="c_${h}" class="chk-save time-check" onclick="save()"><input type="text" id="t_${h}" class="save" style="border:none; background:transparent; font-family:inherit; width:100%; font-size:1.1rem;" placeholder="..."></div>`;
        }

        const swipeArea = document.getElementById('swipeArea');
        swipeArea.addEventListener('touchstart', e => { touchStartY = e.changedTouches[0].screenY; }, false);
        swipeArea.addEventListener('touchend', e => { touchEndY = e.changedTouches[0].screenY; handleSwipe(); }, false);

        load();
    }

    function handleSwipe() {
        const threshold = 50;
        if (touchStartY - touchEndY > threshold) turn(1);
        else if (touchEndY - touchStartY > threshold) turn(-1);
    }

    function handleMove(e) {
        const b = document.getElementById('book'); if(b.classList.contains('open')) return;
        const rect = b.getBoundingClientRect();
        const x = (e.clientX - rect.left) / rect.width;
        const y = (e.clientY - rect.top) / rect.height;
        const rx = (y - 0.5) * -25; const ry = (x - 0.5) * 25;
        b.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    }

    function resetMove() { document.getElementById('book').style.transform = `rotateX(0deg) rotateY(0deg)`; }

    function getID(d) { return `elite_v7_${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; }

    function openBook() { document.getElementById('book').classList.add('open'); }
    function closeBook() { save(); document.getElementById('book').classList.remove('open'); }

    function turn(dir) {
        if(flipping) return;
        save();
        document.getElementById('flipSound').play().catch(()=>{});
        const p = document.getElementById('page'); p.classList.add('flipping');
        flipping = true;
        setTimeout(() => {
            vDate.setDate(vDate.getDate() + dir); load();
            p.style.transition = 'none'; p.style.transform = 'rotateX(0deg)';
            p.offsetHeight; p.style.transition = ''; p.classList.remove('flipping');
            flipping = false;
        }, 500);
    }

    function load() {
        const key = getID(vDate);
        const data = JSON.parse(localStorage.getItem(key)) || {};
        habits = data.habits || {}; sealed = data.sealed || false;
        document.querySelectorAll('.save').forEach(el => { el.value = data[el.id] || ''; el.disabled = sealed; });
        document.querySelectorAll('.chk-save').forEach(el => { el.checked = data[el.id] || false; el.disabled = sealed; });
        document.getElementById('userImg').src = data.photo || LOCAL_PLACEHOLDER;
        document.getElementById('waxSeal').classList.toggle('sealed', sealed);
        document.getElementById('page').classList.toggle('locked', sealed);
        document.getElementById('dateDisp').innerText = vDate.toLocaleDateString(undefined, {month:'short', day:'numeric', year:'numeric'});
        updateHabitUI(); updateGrowth();
    }

    function save() {
        try {
            const data = { habits, sealed, photo: document.getElementById('userImg').src };
            document.querySelectorAll('.save').forEach(el => data[el.id] = el.value);
            document.querySelectorAll('.chk-save').forEach(el => data[el.id] = el.checked);
            localStorage.setItem(getID(vDate), JSON.stringify(data));
            updateGrowth();
        } catch (e) {
            if (e.name === 'QuotaExceededError') {
                alert("Archive full. Automatic cleanup of oldest entry.");
                localStorage.removeItem(localStorage.key(0));
            }
        }
    }

    function updateGrowth() {
        let h = Object.values(habits).filter(v => v).length;
        let t = Array.from(document.querySelectorAll('.chk-save')).filter(x => x.checked).length;
        let p = Math.min(Math.round(((h + t) / 23) * 100), 100);
        document.getElementById('growthFill').style.width = p + '%';
        document.getElementById('percDisp').innerText = p + '%';
        return p;
    }

    function tapHabit(id) { if(!sealed) { habits[id] = !habits[id]; updateHabitUI(); save(); } }
    function updateHabitUI() { ['water','gym','read','sun','zen'].forEach(id => document.getElementById('h_'+id).classList.toggle('active', !!habits[id])); }
    function toggleSeal() { sealed = !sealed; save(); load(); }
    function toggleDrawer() { document.getElementById('pocket').classList.toggle('open'); }

    function openCal() {
        const g = document.getElementById('calGrid'); g.innerHTML = '';
        const now = new Date();
        for(let i=-10; i<=10; i++) {
            let d = new Date(); d.setDate(now.getDate() + i);
            let b = document.createElement('div');
            b.style = `padding:8px; border-radius:8px; cursor:pointer; background:${d.toDateString()===vDate.toDateString()?'var(--gold)':'#f1f5f9'}; color:${d.toDateString()===vDate.toDateString()?'#fff':'#111'}`;
            b.innerHTML = `<span style="font-size:0.5rem; display:block; opacity:0.6;">${d.toLocaleDateString(undefined,{weekday:'short'})}</span>${d.getDate()}`;
            b.onclick = () => { vDate = new Date(d); vDate.setHours(0,0,0,0); load(); document.getElementById('calOverlay').style.display='none'; };
            g.appendChild(b);
        }
        document.getElementById('calOverlay').style.display='flex';
    }

    function jumpToday() { vDate = new Date(); vDate.setHours(0,0,0,0); load(); document.getElementById('calOverlay').style.display='none'; }

    function processImg(e) {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = img.width; let height = img.height;
                const MAX_WIDTH = 800;
                if (width > MAX_WIDTH) { height *= MAX_WIDTH / width; width = MAX_WIDTH; }
                canvas.width = width; canvas.height = height;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(img, 0, 0, width, height);
                const dataUrl = canvas.toDataURL('image/jpeg', 0.6);
                document.getElementById('userImg').src = dataUrl;
                save();
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    }

    function openReport() {
        const p = updateGrowth();
        document.getElementById('reportPerc').innerText = p + "%";
        document.getElementById('reportFill').style.width = p + "%";
        document.getElementById('quote').innerText = p === 100 ? "Success is defined by your consistency." : "Growth is a process, not an event.";
        document.getElementById('reportOverlay').style.display = 'flex';
    }

    function syncLast() {
        if(sealed) return;
        let y = new Date(vDate); y.setDate(vDate.getDate()-1);
        const d = JSON.parse(localStorage.getItem(getID(y)));
        if(!d) return alert("Nothing found to copy.");
        if(confirm("Duplicate previous goals?")) {
            habits = d.habits || {};
            for(let h=6; h<=23; h++) { if(d[`t_${h}`]) document.getElementById(`t_${h}`).value = d[`t_${h}`]; }
            save(); load();
        }
    }

    function clearDay() { if(!sealed && confirm("Reset this page?")) { localStorage.removeItem(getID(vDate)); load(); } }
</script>
</body>
</html>