<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Royal Success Archive | ‚ú® Elite Bloom</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@900&family=Patrick+Hand&family=Playfair+Display:ital,wght@0,700;1,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --navy: #02060c; --paper: #fdfaf0; --ink: #1a1a1a;
            --gold: #d4af37; --gold-foil: #f1c40f; --wax: #8b0000;
            --leaf: #10b981; --royal-blue: #0a1b33;
        }

        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        
        body {
            font-family: 'Patrick Hand', cursive; 
            background: #050505 radial-gradient(circle at center, #0a1b33 0%, #050505 100%);
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;
            min-height: 100vh; overflow: hidden; perspective: 1500px;
            touch-action: pan-y; 
        }

        /* --- MAGIC AMBIENCE --- */
        .sparkle { position: absolute; background: var(--gold); border-radius: 50%; opacity: 0.4; pointer-events: none; z-index: 1; animation: rise 10s infinite linear; }
        @keyframes rise { 0% { transform: translateY(100vh) scale(0); opacity: 0; } 50% { opacity: 0.5; } 100% { transform: translateY(-10vh) scale(1.5); opacity: 0; } }

        /* --- 3D BOOK CONTAINER --- */
        .scene { 
            width: 94%; max-width: 440px; 
            height: 75vh; 
            transform-style: preserve-3d; 
            /* Increased Gap between book and buttons */
            margin-bottom: 180px; 
            position: relative;
        }
        .book { 
            position: relative; width: 100%; height: 100%; 
            background: var(--navy); border-radius: 20px; 
            transform-style: preserve-3d; 
            box-shadow: 0 60px 150px rgba(0,0,0,1); 
            transition: transform 0.1s ease-out; 
        }

        /* --- IMPROVED GOLDEN SPIRAL --- */
        .spiral-rail {
            position: absolute; top: -25px; left: 15px; 
            width: calc(100% - 30px); height: 50px;
            display: flex; justify-content: space-between; 
            z-index: 2000; pointer-events: none;
        }
        .ring-group {
            display: flex; flex-direction: column; align-items: center; width: 25px;
        }
        .ring {
            width: 14px; height: 50px; 
            /* Realistic Gold Gradient */
            background: linear-gradient(90deg, #8a6e2f, #ffd700, #fff, #ffd700, #8a6e2f);
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.8);
            transform: rotate(-4deg);
        }
        .hole {
            width: 14px; height: 14px; background: #000; border-radius: 50%;
            margin-top: -10px; /* Tucks underneath the ring */
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.3);
            z-index: -1;
        }

        /* --- INTERACTIVE PARALLAX COVER --- */
        .cover { 
            position: absolute; inset: 0; background: var(--navy); border-radius: 20px; 
            z-index: 500; transform-origin: top; transition: transform 1s cubic-bezier(0.4, 0, 0.2, 1); 
            display: flex; flex-direction: column; justify-content: center; align-items: center; 
            backface-visibility: hidden; cursor: pointer; border: 3px solid var(--gold); overflow: hidden;
        }
        .cover-bg { position: absolute; inset: 0; opacity: 0.2; background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M40 0c22.091 0 40 17.909 40 40S62.091 80 40 80 0 62.091 0 40 17.909 0 40 0zm0 10c-16.569 0-30 13.431-30 30s13.431 30 30 30 30-13.431 30-30-13.431-30-30-30z' fill='%23d4af37' fill-opacity='0.4'/%3E%3C/svg%3E"); }
        
        .floating-text { position: absolute; font-family: 'Montserrat', sans-serif; font-weight: 900; color: rgba(212, 175, 55, 0.1); pointer-events: none; text-transform: uppercase; line-height: 0.8; }
        #succ-bg { font-size: 10rem; top: 5%; left: -5%; }
        
        .main-plate {
            z-index: 10; padding: 40px; border: 2px solid var(--gold);
            background: rgba(0,0,0,0.8); text-align: center; border-radius: 4px;
            backdrop-filter: blur(15px); transform: translateZ(80px);
            box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
        }
        .main-plate h1 { margin: 0; font-family: 'Playfair Display', serif; font-size: 2.8rem; color: #fff; letter-spacing: 5px; text-shadow: 0 2px 15px var(--gold); }
        .main-plate p { color: var(--gold); margin-top: 15px; font-size: 0.8rem; letter-spacing: 4px; font-weight: bold; }
        
        .book.open .cover { transform: rotateX(165deg); }

        /* --- PAGES --- */
        .page-container { position: absolute; inset: 10px; transform-style: preserve-3d; }
        .page { 
            position: absolute; inset: 0; background: var(--paper); 
            padding: 30px 25px 25px 25px; 
            border-radius: 8px; transform-origin: top; 
            backface-visibility: hidden; transition: transform 0.8s cubic-bezier(0.4, 0, 0.2, 1); z-index: 10; 
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            border: 1px solid #e0d0b0;
            box-shadow: inset 0 0 80px rgba(197, 160, 89, 0.1);
            touch-action: pan-y;
        }
        .page.flipping { transform: rotateX(180deg) scale(1.02); filter: brightness(0.9); }
        .page.locked { filter: sepia(0.5) contrast(0.85); pointer-events: none; }

        /* --- EMOJI UI ELEMENTS --- */
        .section-emoji { font-size: 1.2rem; margin-right: 8px; }
        .section-tag { font-family: 'Playfair Display', serif; font-size: 1rem; color: var(--navy); margin: 25px 0 10px; border-bottom: 2px solid var(--gold); display: flex; align-items: center; font-weight: 700; }
        
        .growth-meter { height: 16px; background: #e2e8f0; border-radius: 20px; overflow: hidden; margin: 15px 0; border: 1px solid #cbd5e1; box-shadow: inset 0 2px 5px rgba(0,0,0,0.1); }
        #growthFill { width: 0%; height: 100%; background: linear-gradient(90deg, #16a34a, #f1c40f, #c5a059); transition: 1.5s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
        #growthFill::after { content: '‚ú®'; position: absolute; right: 5px; top: -2px; font-size: 0.8rem; }

        .habit-dock { display: flex; justify-content: space-around; padding: 18px; background: rgba(255,255,255,0.7); border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--gold); box-shadow: 0 10px 25px rgba(0,0,0,0.05); }
        .badge { font-size: 2.2rem; opacity: 0.2; transition: 0.4s; cursor: pointer; filter: grayscale(1); }
        .badge.active { opacity: 1; transform: scale(1.35) rotate(8deg); filter: grayscale(0); drop-shadow: 0 5px 15px rgba(0,0,0,0.2); }

        .row-item { display: flex; align-items: center; gap: 15px; padding: 12px 0; border-bottom: 1px solid rgba(197,160,89,0.15); }
        .custom-check { width: 24px; height: 24px; accent-color: var(--gold); cursor: pointer; border-radius: 50%; }
        input[type="text"] { border: none; background: transparent; font-family: inherit; width: 100%; font-size: 1.15rem; color: var(--ink); }

        /* --- SECRET DRAWER --- */
        .drawer-handle { background: var(--navy); color: #fff; padding: 16px; text-align: center; cursor: pointer; font-weight: bold; border-radius: 15px; margin-top: 25px; border: 2px solid var(--gold); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
        #pocket { max-height: 0; overflow: hidden; transition: 0.6s ease-in-out; }
        #pocket.open { max-height: 1000px; padding-top: 25px; }
        
        .polaroid-royal { 
            width: 85%; background: #fff; padding: 12px 12px 60px 12px; 
            box-shadow: 15px 25px 50px rgba(0,0,0,0.4); margin: 0 auto; 
            border: 1px solid #eee; transform: rotate(-2deg); transition: 0.3s;
        }
        .polaroid-royal img { width: 100%; min-height: 200px; object-fit: cover; border-radius: 2px; }

        /* --- NAV DOCK --- */
        .nav-dock { 
            position: fixed; 
            bottom: 50px; /* Positioned carefully to not overlap */
            left: 50%; transform: translateX(-50%); 
            display: flex; align-items: center; 
            gap: 15px; 
            background: rgba(0,0,0,0.9); 
            backdrop-filter: blur(25px); padding: 12px 25px; 
            border-radius: 80px; z-index: 5000; border: 2px solid var(--gold); 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5); 
        }
        
        .nav-btn { 
            width: 50px; height: 50px; border-radius: 50%; 
            background: #fff; border: none; 
            display: flex; align-items: center; justify-content: center; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.3); 
            cursor: pointer; font-size: 1.3rem; transition: 0.3s; 
        }
        .nav-btn:hover { transform: scale(1.1); background: var(--paper); }
        
        .nav-btn.main { 
            width: 60px; height: 60px; 
            background: var(--gold); color: white; 
            border: 4px solid var(--navy); 
            font-size: 1.8rem; 
        }
        .nav-btn.main:hover { transform: scale(1.1); }

        /* --- MODALS --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); z-index: 6000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal { background: var(--paper); padding: 40px; border-radius: 30px; border: 3px solid var(--gold); width: 100%; max-width: 400px; text-align: center; box-shadow: 0 0 100px rgba(212, 175, 55, 0.4); }

        #waxSeal { position: absolute; bottom: 40px; right: 40px; width: 70px; height: 70px; background: var(--wax); border-radius: 50%; color: var(--gold); display: flex; align-items: center; justify-content: center; transform: scale(0); transition: 0.5s; cursor: pointer; z-index: 100; font-size: 2rem; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        #waxSeal.sealed { transform: scale(1) rotate(-15deg); }
    </style>
</head>
<body onload="init()">

    <div id="ambient"></div>
    
    <div class="scene">
        <div class="book" id="book" onmousemove="handleMove(event)" onmouseleave="resetMove()">
            
            <div class="spiral-rail">
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
                <div class="ring-group"><div class="ring"></div><div class="hole"></div></div>
            </div>

            <div class="cover" onclick="openBook()">
                <div class="cover-bg"></div>
                <div class="floating-text" id="succ-bg">SUCCESS</div>
                <div class="main-plate">
                    <h1>ARCHIVE</h1>
                    <p>‚ú® Precision ‚Ä¢ Strategy ‚Ä¢ Power ‚ú®</p>
                </div>
            </div>

            <div class="page-container" id="swipeArea">
                <div class="page" id="page">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="dateDisp" style="color:var(--navy); font-weight:bold; font-family: 'Playfair Display'; font-size:1.4rem;"></span>
                        <span id="percDisp" style="color:var(--leaf); font-weight:bold; font-size: 1.2rem;">0% ‚ú®</span>
                    </div>
                    <div class="growth-meter"><div id="growthFill"></div></div>

                    <div class="section-tag"><span class="section-emoji">üå∏</span> Royal Habits</div>
                    <div class="habit-dock">
                        <span class="badge" onclick="tapHabit('water')" id="h_water">üíß</span>
                        <span class="badge" onclick="tapHabit('gym')" id="h_gym">üí™</span>
                        <span class="badge" onclick="tapHabit('read')" id="h_read">üìö</span>
                        <span class="badge" onclick="tapHabit('sun')" id="h_sun">‚òÄÔ∏è</span>
                        <span class="badge" onclick="tapHabit('zen')" id="h_zen">üßò</span>
                    </div>

                    <div class="section-tag"><span class="section-emoji">üéØ</span> Main Objectives</div>
                    <div id="goalsList"></div>

                    <div class="section-tag"><span class="section-emoji">‚è∞</span> Royal Timeline</div>
                    <div id="schedule"></div>

                    <textarea id="notes" class="save" style="margin-top:30px; height:130px; border-left:5px solid var(--gold); padding:20px; width:100%; border:none; background:rgba(197, 160, 89, 0.05); font-size: 1.2rem; border-radius: 10px;" placeholder="What defines today's victory?"></textarea>

                    <div class="drawer-handle" onclick="toggleDrawer()">üóùÔ∏è OPEN SECRET COMPARTMENT</div>
                    <div id="pocket">
                        <div class="polaroid-royal" onclick="document.getElementById('imgInp').click()">
                            <img id="userImg" src="">
                            <p style="text-align:center; font-size:0.9rem; color:#888; margin-top:15px; font-weight: bold; letter-spacing: 2px;">‚öú MEMORIAM ‚öú</p>
                        </div>
                        <textarea id="secret" class="save" style="height:100px; width:100%; border:1px solid #e0d0b0; margin-top:20px; padding:15px; border-radius:12px; background: #fff;" placeholder="Private royal thoughts..."></textarea>
                    </div>

                    <div id="waxSeal" onclick="toggleSeal()">‚öú</div>
                </div>
            </div>
        </div>
    </div>

    <audio id="flipSound"><source src="https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3" type="audio/mpeg"></audio>
    <input type="file" id="imgInp" hidden accept="image/*" onchange="processImg(event)">

    <div class="overlay" id="calOverlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="font-family: 'Playfair Display'; color: var(--gold);">‚öú Archive Map ‚öú</h2>
            <button onclick="jumpToday()" style="width:100%; padding:16px; background:var(--gold); border:none; color:white; border-radius:15px; font-weight:bold; margin-bottom:25px; cursor:pointer; font-size: 1rem;">‚ú® BACK TO TODAY ‚ú®</button>
            <div id="calGrid" style="display:grid; grid-template-columns: repeat(7, 1fr); gap: 10px;"></div>
        </div>
    </div>

    <div class="overlay" id="reportOverlay" onclick="this.style.display='none'">
        <div class="modal" onclick="event.stopPropagation()">
            <h2 style="font-family: 'Playfair Display'; color: var(--gold);">üëë ROYAL BLOOM üëë</h2>
            <div style="font-size: 6rem; font-weight: 900; color: var(--leaf); text-shadow: 0 5px 15px rgba(0,0,0,0.1);" id="reportPerc">0%</div>
            <div class="growth-meter"><div id="reportFill" style="height:100%; background:var(--gold); width:0%;"></div></div>
            <p id="quote" style="font-style: italic; color: #555; margin-top: 25px; font-size: 1.2rem;"></p>
            <button onclick="document.getElementById('reportOverlay').style.display='none'" style="width:100%; padding:16px; margin-top:30px; background:var(--navy); color:white; border-radius:15px; border:none; font-weight:bold; cursor:pointer;">üëë CONTINUE REIGN üëë</button>
        </div>
    </div>

    <nav class="nav-dock">
        <button class="nav-btn" onclick="openCal()" title="Calendar">üìÖ</button>
        <button class="nav-btn main" onclick="closeBook()" title="Home">üëë</button>
        <button class="nav-btn" onclick="syncLast()" title="Copy Yesterday">ü™Ñ</button>
        <button class="nav-btn" onclick="clearDay()" title="Clear Day">üßπ</button>
        <button class="nav-btn" onclick="openReport()" title="Stats">üìä</button>
    </nav>

<script>
    let vDate = new Date(); vDate.setHours(0,0,0,0);
    let flipping = false, sealed = false;
    let habits = {};
    const LOCAL_PLACEHOLDER = "data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='350' height='300'%3E%3Crect width='350' height='300' fill='%23f9f9f9'/%3E%3Ctext x='50%25' y='50%25' dominant-baseline='middle' text-anchor='middle' font-family='serif' font-size='20' fill='%23c5a059'%3E‚öú Tap to Attach Memory ‚öú%3C/text%3E%3C/svg%3E";

    // --- IMPROVED SWIPE LISTENERS ---
    let touchStartX = 0;
    let touchStartY = 0;

    function init() {
        const amb = document.getElementById('ambient');
        for(let i=0; i<20; i++) {
            let s = document.createElement('div'); s.className='sparkle';
            s.style.left = Math.random()*100+'vw'; s.style.animationDelay = Math.random()*10+'s';
            s.style.width = s.style.height = Math.random()*4+1+'px';
            amb.appendChild(s);
        }

        const gl = document.getElementById('goalsList'); gl.innerHTML = '';
        for(let i=1; i<=3; i++) {
            gl.innerHTML += `<div class="row-item"><input type="checkbox" id="gcheck_${i}" class="chk-save custom-check" onclick="save()"><input type="text" id="goal_${i}" class="save" placeholder="Objective ${i}..."></div>`;
        }

        const s = document.getElementById('schedule'); s.innerHTML = '';
        for(let h=6; h<=23; h++) {
            let lbl = h > 12 ? (h-12)+' PM' : (h==12 ? '12 PM' : h+' AM');
            s.innerHTML += `<div class="row-item"><span style="font-size:0.85rem; color:#94a3b8; width:55px; font-weight:bold;">${lbl}</span><input type="checkbox" id="c_${h}" class="chk-save custom-check" onclick="save()"><input type="text" id="t_${h}" class="save" style="font-size:1.15rem;" placeholder="..."></div>`;
        }

        const swipeArea = document.getElementById('swipeArea');
        
        swipeArea.addEventListener('touchstart', e => { 
            touchStartX = e.changedTouches[0].screenX; 
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        swipeArea.addEventListener('touchend', e => { 
            let touchEndX = e.changedTouches[0].screenX;
            let touchEndY = e.changedTouches[0].screenY;
            
            let diffX = touchStartX - touchEndX;
            let diffY = touchStartY - touchEndY;

            // SCROLL GUARD
            if (Math.abs(diffX) > 60 && Math.abs(diffX) > Math.abs(diffY)) {
                if (diffX > 0) turn(1); // Swipe Left -> Next
                else turn(-1);          // Swipe Right -> Prev
            }
        }, false);

        load();
    }

    function handleMove(e) {
        const b = document.getElementById('book'); if(b.classList.contains('open')) return;
        const rect = b.getBoundingClientRect();
        const rx = ((e.clientY - rect.top) / rect.height - 0.5) * -30;
        const ry = ((e.clientX - rect.left) / rect.width - 0.5) * 30;
        b.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
        document.getElementById('succ-bg').style.transform = `translate(${ry*2}px, ${rx*2}px)`;
    }

    function resetMove() { document.getElementById('book').style.transform = `rotateX(0deg) rotateY(0deg)`; }

    function getID(d) { return `success_final_v11_${d.getFullYear()}-${d.getMonth()+1}-${d.getDate()}`; }

    function openBook() { document.getElementById('book').classList.add('open'); }
    function closeBook() { save(); document.getElementById('book').classList.remove('open'); }

    function turn(dir) {
        if(flipping) return; flipping = true; save();
        document.getElementById('flipSound').play().catch(()=>{});
        const p = document.getElementById('page'); p.classList.add('flipping');
        setTimeout(() => {
            vDate.setDate(vDate.getDate() + dir); load();
            p.style.transition = 'none'; p.style.transform = 'rotateX(0deg)';
            p.offsetHeight; p.style.transition = ''; p.classList.remove('flipping');
            flipping = false;
        }, 600);
    }

    function load() {
        const key = getID(vDate);
        const data = JSON.parse(localStorage.getItem(key)) || {};
        sealed = data.sealed || false; habits = data.habits || {};
        document.querySelectorAll('.save').forEach(el => { el.value = data[el.id] || ''; el.disabled = sealed; });
        document.querySelectorAll('.chk-save').forEach(el => { el.checked = data[el.id] || false; el.disabled = sealed; });
        document.getElementById('userImg').src = data.photo || LOCAL_PLACEHOLDER;
        document.getElementById('waxSeal').classList.toggle('sealed', sealed);
        document.getElementById('page').classList.toggle('locked', sealed);
        document.getElementById('dateDisp').innerText = vDate.toLocaleDateString(undefined, {weekday: 'short', month:'short', day:'numeric'});
        updateHabitUI(); updateGrowth();
    }

    function save() {
        try {
            const data = { sealed, photo: document.getElementById('userImg').src, habits: habits };
            document.querySelectorAll('.save').forEach(el => data[el.id] = el.value);
            document.querySelectorAll('.chk-save').forEach(el => data[el.id] = el.checked);
            localStorage.setItem(getID(vDate), JSON.stringify(data));
            updateGrowth();
        } catch (e) { localStorage.removeItem(localStorage.key(0)); }
    }

    function updateGrowth() {
        let hPoints = Object.values(habits).filter(v => v).length;
        let tPoints = Array.from(document.querySelectorAll('.chk-save')).filter(x => x.checked).length;
        let p = Math.min(Math.round(((hPoints + tPoints) / 26) * 100), 100);
        document.getElementById('growthFill').style.width = p + '%';
        document.getElementById('percDisp').innerText = p + '%';
        return p;
    }

    function tapHabit(id) { if(!sealed) { habits[id] = !habits[id]; updateHabitUI(); save(); } }
    function updateHabitUI() { ['water','gym','read','sun','zen'].forEach(id => {
        const b = document.getElementById('h_'+id); if(b) b.classList.toggle('active', !!habits[id]);
    }); }

    function toggleSeal() { sealed = !sealed; save(); load(); }
    function toggleDrawer() { document.getElementById('pocket').classList.toggle('open'); }

    function openCal() {
        const g = document.getElementById('calGrid'); g.innerHTML = '';
        for(let i=-10; i<=10; i++) {
            let d = new Date(); d.setDate(new Date().getDate() + i);
            let b = document.createElement('div');
            b.style = `padding:12px; border-radius:12px; cursor:pointer; background:${d.toDateString()===vDate.toDateString()?'var(--gold)':'#f1f5f9'}; color:${d.toDateString()===vDate.toDateString()?'#fff':'#111'}; font-weight:bold; box-shadow: 0 4px 8px rgba(0,0,0,0.05)`;
            b.innerHTML = `<span style="font-size:0.6rem; display:block; opacity:0.6;">${d.toLocaleDateString(undefined,{weekday:'short'})}</span>${d.getDate()}`;
            b.onclick = () => { vDate = new Date(d); vDate.setHours(0,0,0,0); load(); document.getElementById('calOverlay').style.display='none'; };
            g.appendChild(b);
        }
        document.getElementById('calOverlay').style.display='flex';
    }

    function jumpToday() { vDate = new Date(); vDate.setHours(0,0,0,0); load(); document.getElementById('calOverlay').style.display='none'; }

    function processImg(e) {
        const reader = new FileReader();
        reader.onload = (event) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                let width = 600; let height = img.height * (600 / img.width);
                canvas.width = width; canvas.height = height;
                canvas.getContext('2d').drawImage(img, 0, 0, width, height);
                document.getElementById('userImg').src = canvas.toDataURL('image/jpeg', 0.5);
                save();
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(e.target.files[0]);
    }

    function openReport() {
        const p = updateGrowth();
        document.getElementById('reportPerc').innerText = p + "%";
        document.getElementById('reportFill').style.width = p + "%";
        document.getElementById('quote').innerText = p === 100 ? "A majestic reign of productivity! üëë" : "The empire is built one brick at a time. ‚ú®";
        document.getElementById('reportOverlay').style.display = 'flex';
    }

    function syncLast() {
        let y = new Date(vDate); y.setDate(vDate.getDate()-1);
        const d = JSON.parse(localStorage.getItem(getID(y)));
        if(d && confirm("ü™Ñ Sync your previous royal objectives?")) {
            habits = d.habits || {};
            for(let i=1; i<=3; i++) document.getElementById(`goal_${i}`).value = d[`goal_${i}`] || '';
            for(let h=6; h<=23; h++) document.getElementById(`t_${h}`).value = d[`t_${h}`] || '';
            save(); load();
        }
    }

    function clearDay() { if(confirm("üßπ Purge this royal record from the archive?")) { localStorage.removeItem(getID(vDate)); load(); } }
</script>
</body>
</html>